{% set ncpus = 1 %}

name: Harmonic Pinning

command:
  - >
    sdrun
    create
    --pressure {pressure}
    --temperature {temperature}
    --space-group {space_group}
    --lattice-lengths {cell_dims}
    --output {outdir}
    --steps {create_steps}
    Trimer-P{pressure:.2f}-T{temperature:.2f}-{space_group}.gsd
  - >
    sdrun
    equil
    --equil-type {equil_type}
    --pressure {pressure}
    --init-temp {temperature}
    --temperature {temperature}
    --space-group {space_group}
    --harmonic-force {harmonic_force}
    --output {outdir}
    --steps {equil_steps}
    Trimer-P{pressure:.2f}-T{temperature:.2f}-{space_group}.gsd
    Trimer-P{pressure:.2f}-T{temperature:.2f}-K{harmonic_force:.2f}-{space_group}.gsd
  - >
    sdrun
    prod
    --pressure {pressure}
    --temperature {temperature}
    --space-group {space_group}
    --harmonic-force {harmonic_force}
    --output {outdir}
    --steps {steps}
    Trimer-P{pressure:.2f}-T{temperature:.2f}-K{harmonic_force:.2f}-{space_group}.gsd

variables:
  outdir: output
  zip:
    - temperature:
        - 0.35
        - 1.35
      pressure:
        - 1.00
        - 13.50

    - space_group:
        - pg
        - p2
        - p2gg
      cell_dims:
        - 30 30
        - 30 30
        - 30 15

  create_steps: 100_000
  equil_type: harmonic
  equil_steps: 1_000_000
  steps: 10_000_000
  harmonic_force:
    {% for i in range(100) %}
      - {{ i * 0.1 }}
    {% endfor %}

pbs:
  setup:
    - export PATH=$HOME/.pyenv/versions/crystal/bin:$PATH
  cpus: {{ ncpus }}
  walltime: 10:00:00
  o: logs
  j: oe
